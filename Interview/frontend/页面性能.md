# 页面性能

1. 资源压缩合并，减少 http 请求
1. 非核心代码异步加载 --> 异步加载方式 --> 异步加载的区别
1. 利用浏览器缓存 --> 缓存分类 --> 缓存原理
1. 使用 CDN
1. 预解析 DNS:
    ```html
    <meta http-equiv="x-dns-prefetch-control" content="on">
    <link rel="dns-prefetch" href="//url.com">
    ```

    https 协议下 a 标签默认浏览器是关闭dns预解析。上面meta告诉浏览器强制打开对 a 标签的 dns 预解析。

## 异步加载方式

1. 动态脚本加载。`document.createElement('script')` 加载到 body, head 中
1. defer
1. async

### 异步加载的区别

1. defer 不阻止文档解析，浏览器遇到 defer 边下载defer script 边往下解析。全解析完之后才执行 defer script。如果多个依次执行。
1. async 不阻止文档解析，浏览器遇到 async 边下载async script 边往下解析。当下载好了后立即执行，此时文档解析可能还没完成。如果多个执行顺序与家在顺序无关

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>性能优化</title>
    <!-- <script src="./defer1.js" charset="utf-8" defer></script>
    <script src="./defer2.js" charset="utf-8" defer></script> -->
    <script src="./async1.js" charset="utf-8" async></script>
    <script src="./async2.js" charset="utf-8" async></script>
  </head>
  <body>
    <div class="">
      test
      <script type="text/javascript">
        console.log('write');
        document.write('<span>write</span>');
      </script>
      <script type="text/javascript">
        for (var i = 0; i < 200000; i++) {
            if (i % 20000 === 0) {
                console.log(i);
            }
        }
      </script>
    </div>
  </body>
</html>
```

结果都是 write，for循环数字，最后是 defer 或者 async 执行。区别 defer 按照加载顺序执行， async 不一定，看文件大小、加载时间。

## 浏览器缓存

1. 强缓存：不跟服务器对话，本地有拿来就用
    ```
    Expires Expires: Thu 绝对时间
    Cache-Control  max-age：3600s 相对时间(以他为准，避免服务器和本地电脑时间不一致)
    ```

1. 协商缓存: 问服务器磁盘上的缓存能不能用
    ```
    Last-Modified If-Modified-Since 他俩值一样。服务器下发Last-Modified, 传给服务器If-Modified-Since 因为服务器要对比。
    Etag If-None-Match Etag判断文件内容是否变化
    ```

跟缓存的 http 头有哪些？Expires, Cache-Control, Last-Modified If-Modified-Since Etag

### 图片优化

图片优化：以前切图，现在某些效果可以用使用css3。字体图标替换

图片分类：jpg小，png大透明，gif，svg地图，apng，webp

css sprite：制作网站 <http://alloyteam.github.io/gopng>

> 注意手机端一般像素是pc端一半，gopng生成的像素是pc端的

* fis3
* grunt-sprite

#### 响应式动态图片加载sdk

* 需要默认图片
* 分辨率信息告诉服务器
* 服务器返回优质图片

==picture标签==

```html
<picture>
    <source srcset="smaller.png" media="(max-width:768px)"></source>
    <source srcset="bigger.png" media="(min-width:1000px)"></source>
    <img srcset="default.png" alt="default img">
</picture>
```

### 视频优化

* video标签 不同浏览器默认样式不同
* flash播放器 过时

#### 需求

* 按照设计师要求制作播放器
* 用户进来就能看

#### 第三方

* videojs
* flowplayer

#### 视频优化点

提前加载视频资源、依赖。flowplayer 支持 html5 和 swf。如果使用 flash，即使 swf 文件写在图片前面，默认浏览器还是会最后加载 swf 这样的多媒体资源。这导致图片阻塞了视频加载。优化点就是如何才能让视频依赖前置。方法是使用样式 link

```html
<link rel="stylesheet" href="flowplayer-3.2.18.swf">
<link rel="stylesheet" href="flowpalyer.controls.swf">
<link rel="stylesheet" href="video.mp4">

<script src=".../flowplayer.min.js"></script>
<script src="init.js"></script>
```

此时这些资源立马加载，之后这些资源从浏览器缓存中取出来很快。

